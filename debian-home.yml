- hosts: localhost
  become: true
  tasks: 
  
  - name: Upgrade system
    apt:
      upgrade: dist
      update_cache: yes
      autoremove: yes
      
  - name: Install packages
    package:
      name:
        # Theming
        - adwaita-qt
        - qgnomeplatform-qt5
        - qt5-gtk-platformtheme
        - qt5-style-plugins
        - qt6-gtk-platformtheme
        - rhythmbox-plugin-alternative-toolbar
        
        # Multimedia editing
        - audacity
        - ffmpeg
        - handbrake
        - lame
        - mkvtoolnix-gui
        - mp3wrap
        - soundconverter
        - sound-juicer
        - gnome-subtitles
        - simplescreenrecorder

        # Multimedia consumption
        - brasero
        - puddletag

        # 3D design
        - freecad
        - pronterface
        - prusa-slicer

        # Office
        - evolution-ews
        - foliate
        - gnome-dictionary
        - lyx
        - nautilus-nextcloud
        - nextcloud-desktop
        - pdfarranger

        # Web browsing
        - firefox-esr
        - webext-ublock-origin-firefox

        # Graphics
        - gimp
        - imagej
        - inkscape

        # System utilities
        - firmware-linux-nonfree
        - flatpak
        - gnome-shell-extension-appindicator
        - gnome-shell-extension-caffeine
        - ibus-libpinyin
        - python3-pip
        - qrencode
        - unattended-upgrades
        - unrar
        - openssh-server
        - remmina

        # Fonts
        - fonts-noto-cjk
        - fonts-noto-cjk-extra
        - fonts-roboto
        - ttf-mscorefonts-installer

        # Games
        - frogatto
        - gnome-games
        - gnome-mastermind
        - supertux
        - supertuxkart
        - unknown-horizons
        
      state: latest
      
  - name: Uninstall packages
    package:
      name:
        # Web browsing        
        - chromium
        - epiphany-browser
        - webext-ublock-origin-chromium
        
        # Games
        - 0ad
        - openttd

        # Virtualisation        
        - gnome-boxes
        - libvirt-clients
        - spice-client-gtk
        - spice-webdavd

        # Other
        - blender
        - clamtk
        - fonts-arphic-*
        - gchempaint
        - gcu-bin
        - ghostwriter
        - gnome-software-plugin-flatpak
        - grsync
        - gufw
        - homebank
        - keepassxc
        - musescore3
        - pandoc
        - pitivi
        - r-base
        - r-*
        - scribus
        - sigil
        - steam-devices
        - synaptic
        - termit
        - timekpr-next
        #- torbrowser-launcher
        #- virtualbox*
        - vlc
        - warzone2100
        - webext-https-everywhere # Deprecated
        - webext-privacy-badger
        - wireguard
      state: absent      
    
  - name: Enable FlatHub
    flatpak_remote:
      name: flathub
      flatpakrepo_url: https://flathub.org/repo/flathub.flatpakrepo
      method: system
      state: present
      
  - name: Install flatpaks
    flatpak:
      name: "{{item}}"
      method: system
      state: present
    with_items:
      - com.github.tchx84.Flatseal
      - com.usebottles.bottles
      - net.lutris.Lutris
      - org.jitsi.jitsi-meet
      - org.zotero.Zotero
    when: ansible_architecture == "x86_64"
  
  - name: Uninstall flatpaks
    flatpak:
      name: "{{item}}"
      method: system
      state: absent
    with_items:
      - app.drey.Dialect
      - com.bitwarden.desktop
      - com.github.johnfactotum.Foliate
      - com.microsoft.Teams
      - com.tutanota.Tutanota
      - com.valvesoftware.Steam
      - de.haeckerfelix.Shortwave
      - edu.mit.Scratch
      - io.freetubeapp.FreeTube
      - io.github.mimbrero.WhatsAppDesktop
      - org.chromium.Chromium
      #- org.gnome.Boxes
      - uk.co.ibboard.cawbird
      - us.zoom.Zoom
    when: ansible_architecture == "x86_64"
    
  - name: Schedule maintenance
    cron:
      name: "Hourly ansible-pull config"
      job: "ansible-pull -U https://github.com/ngkengwooi/desktop-config debian-home.yml"
      minute: "0"
      user: root
